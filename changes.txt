--- Changes for Commit 12024bcd6f88294938d4dfad1d7b7bbf9fb8c39e in L33Z22L11/blog-v3 ---

File 1/10: app/app.config.ts (Status: modified)
-----------------------------------------------
  This file was modified:
  --- Diff Hunk: @@ -9,31 +9,26 @@ export default defineAppConfig({ ---
  Line 9/9: CONTEXT -> '// 将 blog.config 中的配置项复制到 appConfig，方便调用'
  Line 10/10: CONTEXT -> '...blogConfig,'
  Line 11/11: CONTEXT -> ''
  Line 12: DELETED -> 'article: {'
  Line 13: DELETED -> 'categories: <{ [category: string]: { icon: string, color?: string } }>{'
  Line 14: DELETED -> '经验分享: { icon: 'ph:mouse-bold', color: '#3af' },'
  Line 15: DELETED -> '杂谈: { icon: 'ph:chat-bold', color: '#3ba' },'
  Line 16: DELETED -> '生活: { icon: 'ph:shooting-star-bold', color: '#f77' },'
  Line 17: DELETED -> '代码: { icon: 'ph:code-bold', color: '#77f' },'
  Line 18: DELETED -> '[blogConfig.content.defaultCategory]: { icon: 'ph:folder-dotted-bold' },'
  Line 12: ADDED -> 'component: {'
  Line 13: ADDED -> 'codeblock: {'
  Line 14: ADDED -> '/** 代码块触发折叠的行数 */'
  Line 15: ADDED -> 'triggerRows: 32,'
  Line 16: ADDED -> '/** 代码块折叠后的行数 */'
  Line 17: ADDED -> 'collapsedRows: 16,'
  Line 19/18: CONTEXT -> '},'
  Line 20: DELETED -> 'defaultCategoryIcon: 'ph:folder-bold','
  Line 21: DELETED -> '/** 分类排序方式，键为排序字段，值为显示名称 */'
  Line 22: DELETED -> 'order: {'
  Line 23: DELETED -> 'date: '创建日期','
  Line 24: DELETED -> 'updated: '更新日期','
  Line 25: DELETED -> '// title: '标题','
  Line 26: DELETED -> '},'
  Line 27: DELETED -> '},'
  Line 28/19: CONTEXT -> ''
  Line 29: DELETED -> 'content: {'
  Line 30: DELETED -> '/** 代码块自动折叠触发行数 */'
  Line 31: DELETED -> 'codeblockCollapsibleRows: 16,'
  Line 32/20: CONTEXT -> '/** 文章开头摘要 */'
  Line 33/21: CONTEXT -> 'excerpt: {'
  Line 34/22: CONTEXT -> 'animation: true,'
  Line 35/23: CONTEXT -> 'caret: '_','
  Line 36/24: CONTEXT -> '},'
  Line 25: ADDED -> ''
  Line 26: ADDED -> 'stats: {'
  Line 27: ADDED -> '/** 归档页面每年标题对应的年龄 */'
  Line 28: ADDED -> 'birthYear: 2003,'
  Line 29: ADDED -> '/** blog-stats widget 的预置文本 */'
  Line 30: ADDED -> 'wordCount: '约10万','
  Line 31: ADDED -> '},'
  Line 37/32: CONTEXT -> '},'
  Line 38/33: CONTEXT -> ''
  Line 39/34: CONTEXT -> '// @keep-sorted'
  --- Diff Hunk: @@ -68,7 +63,7 @@ export default defineAppConfig({ ---
  Line 68/63: CONTEXT -> '{'
  Line 69/64: CONTEXT -> 'title: '信息','
  Line 70/65: CONTEXT -> 'items: ['
  Line 71: DELETED -> '{ icon: 'simple-icons:nuxtdotjs', text: 'Nuxt开源博客主题', url: 'https://github.com/L33Z22L11/blog-v3' },'
  Line 66: ADDED -> '{ icon: 'simple-icons:nuxtdotjs', text: '主题: Clarity', url: 'https://github.com/L33Z22L11/blog-v3' },'
  Line 72/67: CONTEXT -> '{ icon: 'ph:swatches-bold', text: '主题和组件文档', url: '/theme' },'
  Line 73/68: CONTEXT -> '{ icon: 'ph:certificate-bold', text: '陕ICP备2025072742号-3', url: 'https://beian.miit.gov.cn/' },'
  Line 74/69: CONTEXT -> '],'
  --- Diff Hunk: @@ -105,13 +100,6 @@ export default defineAppConfig({ ---
  Line 105/100: CONTEXT -> 'allowAscending: false,'
  Line 106/101: CONTEXT -> '},'
  Line 107/102: CONTEXT -> ''
  Line 108: DELETED -> 'stats: {'
  Line 109: DELETED -> '/** 归档页面每年标题对应的年龄 */'
  Line 110: DELETED -> 'birthYear: 2003,'
  Line 111: DELETED -> '/** blog-stats widget 的预置文本 */'
  Line 112: DELETED -> 'wordCount: '约10万','
  Line 113: DELETED -> '},'
  Line 114: DELETED -> ''
  Line 115/103: CONTEXT -> 'themes: {'
  Line 116/104: CONTEXT -> 'light: {'
  Line 117/105: CONTEXT -> 'icon: 'ph:sun-bold','

================================================================================

File 2/10: app/components/content/ProsePre.vue (Status: modified)
-----------------------------------------------------------------
  This file was modified:
  --- Diff Hunk: @@ -32,7 +32,7 @@ const meta = computed(() => { ---
  Line 32/32: CONTEXT -> 'const appConfig = useAppConfig()'
  Line 33/33: CONTEXT -> ''
  Line 34/34: CONTEXT -> 'const rows = computed(() => props.code.split('\n').length - 1)'
  Line 35: DELETED -> 'const collapsible = computed(() => !meta.value.expand && rows.value > appConfig.content.codeblockCollapsibleRows)'
  Line 35: ADDED -> 'const collapsible = computed(() => !meta.value.expand && rows.value > appConfig.component.codeblock.triggerRows)'
  Line 36/36: CONTEXT -> 'const [isCollapsed, toggleCollapsed] = useToggle(collapsible.value)'
  Line 37/37: CONTEXT -> ''
  Line 38/38: CONTEXT -> 'const icon = computed(() => meta.value.icon || getFileIcon(props.filename) || getLangIcon(props.language))'
  --- Diff Hunk: @@ -68,7 +68,7 @@ onMounted(async () => { ---
  Line 68/68: CONTEXT -> '<figure'
  Line 69/69: CONTEXT -> 'class="z-codeblock"'
  Line 70/70: CONTEXT -> ':class="{ collapsed: collapsible && isCollapsed, collapsible }"'
  Line 71: DELETED -> ':style="{ '--collapsible-height': `${appConfig.content.codeblockCollapsibleRows}em` }"'
  Line 71: ADDED -> ':style="{ '--collapsed-rows': appConfig.component.codeblock.collapsedRows }"'
  Line 72/72: CONTEXT -> '>'
  Line 73/73: CONTEXT -> '<figcaption>'
  Line 74/74: CONTEXT -> '<span v-if="filename" class="filename">'
  --- Diff Hunk: @@ -113,17 +113,19 @@ onMounted(async () => { ---
  Line 113/113: CONTEXT -> ''
  Line 114/114: CONTEXT -> '<style lang="scss" scoped>'
  Line 115/115: CONTEXT -> '.z-codeblock {'
  Line 116: ADDED -> '--line-height: 1.4em;'
  Line 117: ADDED -> ''
  Line 116/118: CONTEXT -> 'position: relative;'
  Line 117/119: CONTEXT -> 'overflow: clip;'
  Line 118/120: CONTEXT -> 'border-radius: 0.5em;'
  Line 119/121: CONTEXT -> 'background-color: var(--c-bg-2);'
  Line 120/122: CONTEXT -> 'font-size: 0.8125rem;'
  Line 121: DELETED -> 'line-height: 1.4;'
  Line 123: ADDED -> 'line-height: var(--line-height);'
  Line 122/124: CONTEXT -> ''
  Line 123/125: CONTEXT -> '&.collapsed {'
  Line 124/126: CONTEXT -> 'pre {'
  Line 125/127: CONTEXT -> 'overflow: hidden;'
  Line 126: DELETED -> 'max-height: var(--collapsible-height);'
  Line 128: ADDED -> 'max-height: calc(var(--line-height) * var(--collapsed-rows) + 3rem);'
  Line 127/129: CONTEXT -> 'mask-image: linear-gradient(to top, transparent 2rem, #FFF 4rem);'
  Line 128/130: CONTEXT -> 'animation: none;'
  Line 129/131: CONTEXT -> '}'

================================================================================

File 3/10: app/components/post/Excerpt.vue (Status: modified)
-------------------------------------------------------------
  This file was modified:
  --- Diff Hunk: @@ -8,12 +8,12 @@ const appConfig = useAppConfig() ---
  Line 8/8: CONTEXT -> 'const excerpt = ref(props.excerpt)'
  Line 9/9: CONTEXT -> 'const caret = ref('')'
  Line 10/10: CONTEXT -> ''
  Line 11: DELETED -> 'if (appConfig.content.excerpt?.animation !== false) {'
  Line 11: ADDED -> 'if (appConfig.component.excerpt?.animation !== false) {'
  Line 12/12: CONTEXT -> '// onBeforeMount(() => {'
  Line 13/13: CONTEXT -> 'excerpt.value = '''
  Line 14/14: CONTEXT -> '// })'
  Line 15/15: CONTEXT -> 'onMounted(async () => {'
  Line 16: DELETED -> 'caret.value = appConfig.content.excerpt?.caret ?? '_''
  Line 16: ADDED -> 'caret.value = appConfig.component.excerpt?.caret ?? '_''
  Line 17/17: CONTEXT -> 'for (const char of props.excerpt) {'
  Line 18/18: CONTEXT -> 'excerpt.value += char'
  Line 19/19: CONTEXT -> 'await delay(50)'

================================================================================

File 4/10: app/components/widget/BlogStats.vue (Status: modified)
-----------------------------------------------------------------
  This file was modified:
  --- Diff Hunk: @@ -6,7 +6,7 @@ const runtimeConfig = useRuntimeConfig() ---
  Line 6/6: CONTEXT -> '// 将服务器时区转换为博客指定时区'
  Line 7/7: CONTEXT -> 'const buildTime = toZonedTime(runtimeConfig.public.buildTime, appConfig.timezone)'
  Line 8/8: CONTEXT -> ''
  Line 9: DELETED -> 'const totalWords = ref(appConfig.stats.wordCount)'
  Line 9: ADDED -> 'const totalWords = ref(appConfig.component.stats.wordCount)'
  Line 10/10: CONTEXT -> 'const yearlyTip = ref('')'
  Line 11/11: CONTEXT -> ''
  Line 12/12: CONTEXT -> 'const blogStats = computed(() => [{'

================================================================================

File 5/10: app/pages/archive.vue (Status: modified)
---------------------------------------------------
  This file was modified:
  --- Diff Hunk: @@ -6,7 +6,7 @@ useSeoMeta({ ---
  Line 6/6: CONTEXT -> 'title: '归档','
  Line 7/7: CONTEXT -> 'description: `${appConfig.title}的所有文章归档。`,'
  Line 8/8: CONTEXT -> '})'
  Line 9: DELETED -> 'const birthYear = appConfig.stats.birthYear'
  Line 9: ADDED -> 'const birthYear = appConfig.component.stats.birthYear'
  Line 10/10: CONTEXT -> ''
  Line 11/11: CONTEXT -> 'const layoutStore = useLayoutStore()'
  Line 12/12: CONTEXT -> 'layoutStore.setAside(['blog-stats', 'blog-log'])'

================================================================================

File 6/10: blog.config.ts (Status: modified)
--------------------------------------------
  This file was modified:
  --- Diff Hunk: @@ -2,9 +2,7 @@ import type { FeedEntry } from './app/types/feed' ---
  Line 2/2: CONTEXT -> ''
  Line 3/3: CONTEXT -> 'export { zhCN as dateLocale } from 'date-fns/locale/zh-CN''
  Line 4/4: CONTEXT -> ''
  Line 5: DELETED -> '// 存储 nuxt.config 和 app.config 共用的配置'
  Line 6: DELETED -> '// 此处为启动时需要的配置，启动后可变配置位于 app/app.config.ts'
  Line 7: DELETED -> 'const blogConfig = {'
  Line 5: ADDED -> 'const basicConfig = {'
  Line 8/6: CONTEXT -> 'title: '纸鹿摸鱼处','
  Line 9/7: CONTEXT -> 'subtitle: '纸鹿至麓不知路，支炉制露不止漉','
  Line 10/8: CONTEXT -> '// 长 description 利好于 SEO'
  --- Diff Hunk: @@ -25,11 +23,32 @@ const blogConfig = { ---
  Line 25/23: CONTEXT -> 'timeEstablished: '2019-07-19','
  Line 26/24: CONTEXT -> 'timezone: 'Asia/Shanghai','
  Line 27/25: CONTEXT -> 'url: 'https://blog.zhilu.site/','
  Line 26: ADDED -> 'defaultCategory: '未分类','
  Line 27: ADDED -> '}'
  Line 28: ADDED -> ''
  Line 29: ADDED -> '// 存储 nuxt.config 和 app.config 共用的配置'
  Line 30: ADDED -> '// 此处为启动时需要的配置，启动后可变配置位于 app/app.config.ts'
  Line 31: ADDED -> '// @keep-sorted'
  Line 32: ADDED -> 'const blogConfig = {'
  Line 33: ADDED -> '...basicConfig,'
  Line 28/34: CONTEXT -> ''
  Line 29: DELETED -> 'content: {'
  Line 30: DELETED -> 'defaultCategory: '未分类','
  Line 35: ADDED -> 'article: {'
  Line 36: ADDED -> 'categories: {'
  Line 37: ADDED -> '[basicConfig.defaultCategory]: { icon: 'ph:folder-dotted-bold' },'
  Line 38: ADDED -> '经验分享: { icon: 'ph:mouse-bold', color: '#3af' },'
  Line 39: ADDED -> '杂谈: { icon: 'ph:chat-bold', color: '#3ba' },'
  Line 40: ADDED -> '生活: { icon: 'ph:shooting-star-bold', color: '#f77' },'
  Line 41: ADDED -> '代码: { icon: 'ph:code-bold', color: '#77f' },'
  Line 42: ADDED -> '},'
  Line 43: ADDED -> 'defaultCategoryIcon: 'ph:folder-bold','
  Line 44: ADDED -> '/** 分类排序方式，键为排序字段，值为显示名称 */'
  Line 45: ADDED -> 'order: {'
  Line 46: ADDED -> 'date: '创建日期','
  Line 47: ADDED -> 'updated: '更新日期','
  Line 48: ADDED -> '// title: '标题','
  Line 49: ADDED -> '},'
  Line 31/50: CONTEXT -> '/** 使用 pnpm new 新建文章时自动生成自定义链接（permalink/abbrlink） */'
  Line 32: DELETED -> 'randomPathAtNew: false,'
  Line 51: ADDED -> 'useRandomPremalink: false,'
  Line 33/52: CONTEXT -> '/** 隐藏基于文件路由（不是自定义链接）的 URL /post 路径前缀 */'
  Line 34/53: CONTEXT -> 'hidePostPrefix: true,'
  Line 35/54: CONTEXT -> '/** 禁止搜索引擎收录的路径 */'

================================================================================

File 7/10: content.config.ts (Status: modified)
-----------------------------------------------
  This file was modified:
  --- Diff Hunk: @@ -1,12 +1,13 @@ ---
  Line 1/1: CONTEXT -> 'import { defineCollection, z } from '@nuxt/content''
  Line 2: ADDED -> 'import { asSitemapCollection } from '@nuxtjs/sitemap/content''
  Line 2/3: CONTEXT -> 'import blogConfig from './blog.config''
  Line 3/4: CONTEXT -> ''
  Line 4/5: CONTEXT -> 'const articleSchema = z.object({'
  Line 5/6: CONTEXT -> 'title: z.string(),'
  Line 6/7: CONTEXT -> 'description: z.string().optional(),'
  Line 7/8: CONTEXT -> 'date: z.string().optional(),'
  Line 8/9: CONTEXT -> 'updated: z.string().optional(),'
  Line 9: DELETED -> 'categories: z.array(z.string()).default([blogConfig.content.defaultCategory]),'
  Line 10: ADDED -> 'categories: z.array(z.string()).default([blogConfig.defaultCategory]),'
  Line 10/11: CONTEXT -> 'tags: z.array(z.string()).default([]),'
  Line 11/12: CONTEXT -> 'type: z.enum(['tech', 'story']).optional(),'
  Line 12/13: CONTEXT -> ''
  --- Diff Hunk: @@ -28,9 +29,9 @@ const articleSchema = z.object({ ---
  Line 28/29: CONTEXT -> '})'
  Line 29/30: CONTEXT -> ''
  Line 30/31: CONTEXT -> 'export const collections = {'
  Line 31: DELETED -> 'content: defineCollection({'
  Line 32: ADDED -> 'content: defineCollection(asSitemapCollection({'
  Line 32/33: CONTEXT -> 'source: '**','
  Line 33/34: CONTEXT -> 'type: 'page','
  Line 34/35: CONTEXT -> 'schema: articleSchema,'
  Line 35: DELETED -> '}),'
  Line 36: ADDED -> '})),'
  Line 36/37: CONTEXT -> '}'

================================================================================

File 8/10: nuxt.config.ts (Status: modified)
--------------------------------------------
  This file was modified:
  --- Diff Hunk: @@ -144,7 +144,7 @@ ${packageJson.homepage} ---
  Line 144/144: CONTEXT -> 'return'
  Line 145/145: CONTEXT -> '}'
  Line 146/146: CONTEXT -> '// 在 URL 中隐藏文件路由自动生成的 /posts 路径前缀'
  Line 147: DELETED -> 'if (blogConfig.content.hidePostPrefix) {'
  Line 147: ADDED -> 'if (blogConfig.article.hidePostPrefix) {'
  Line 148/148: CONTEXT -> 'const realPath = ctx.content.path as string'
  Line 149/149: CONTEXT -> 'ctx.content.path = realPath.replace(/^\/posts/, '')'
  Line 150/150: CONTEXT -> '}'
  --- Diff Hunk: @@ -174,7 +174,7 @@ ${packageJson.homepage} ---
  Line 174/174: CONTEXT -> ''
  Line 175/175: CONTEXT -> 'robots: {'
  Line 176/176: CONTEXT -> 'disableNuxtContentIntegration: true,'
  Line 177: DELETED -> 'disallow: blogConfig.content.robotsNotIndex,'
  Line 177: ADDED -> 'disallow: blogConfig.article.robotsNotIndex,'
  Line 178/178: CONTEXT -> '},'
  Line 179/179: CONTEXT -> ''
  Line 180/180: CONTEXT -> 'site: {'

================================================================================

File 9/10: package.json (Status: modified)
------------------------------------------
  This file was modified:
  --- Diff Hunk: @@ -17,51 +17,52 @@ ---
  Line 17/17: CONTEXT -> '"new": "node scripts/new-blog.ts"'
  Line 18/18: CONTEXT -> '},'
  Line 19/19: CONTEXT -> '"dependencies": {'
  Line 20: DELETED -> '"better-sqlite3": "catalog:content",'
  Line 20: ADDED -> '"@nuxt/content": "catalog:content",'
  Line 21: ADDED -> '"@nuxt/icon": "catalog:ui",'
  Line 22: ADDED -> '"@nuxt/image": "catalog:ui",'
  Line 23: ADDED -> '"@nuxtjs/color-mode": "catalog:ui",'
  Line 24: ADDED -> '"@nuxtjs/seo": "catalog:content",'
  Line 25: ADDED -> '"@pinia/nuxt": "catalog:util",'
  Line 26: ADDED -> '"@shikijs/colorized-brackets": "catalog:content",'
  Line 27: ADDED -> '"@shikijs/transformers": "catalog:content",'
  Line 28: ADDED -> '"@vueuse/core": "catalog:util",'
  Line 29: ADDED -> '"@vueuse/nuxt": "catalog:util",'
  Line 30: ADDED -> '"@vueuse/router": "catalog:util",'
  Line 21/31: CONTEXT -> '"ci-info": "catalog:framework",'
  Line 22/32: CONTEXT -> '"date-fns": "catalog:util",'
  Line 23/33: CONTEXT -> '"date-fns-tz": "catalog:util",'
  Line 24/34: CONTEXT -> '"embla-carousel-autoplay": "catalog:ui",'
  Line 25/35: CONTEXT -> '"embla-carousel-vue": "catalog:ui",'
  Line 26/36: CONTEXT -> '"embla-carousel-wheel-gestures": "catalog:ui",'
  Line 27: DELETED -> '"fast-xml-parser": "catalog:util",'
  Line 28/37: CONTEXT -> '"minisearch": "catalog:util",'
  Line 29: DELETED -> '"nanoid": "catalog:util",'
  Line 38: ADDED -> '"nuxt": "catalog:framework",'
  Line 30/39: CONTEXT -> '"parse-domain": "catalog:util",'
  Line 31/40: CONTEXT -> '"plain-shiki": "catalog:content",'
  Line 32/41: CONTEXT -> '"radash": "catalog:util",'
  Line 33: DELETED -> '"rehype-katex": "catalog:content",'
  Line 34: DELETED -> '"remark-math": "catalog:content",'
  Line 35: DELETED -> '"unplugin-yaml": "catalog:framework",'
  Line 42: ADDED -> '"shiki": "catalog:content",'
  Line 43: ADDED -> '"vue": "catalog:framework",'
  Line 44: ADDED -> '"vue-router": "catalog:framework",'
  Line 36/45: CONTEXT -> '"vue-tippy": "catalog:ui",'
  Line 37/46: CONTEXT -> '"vue-virtual-scroller": "catalog:ui"'
  Line 38/47: CONTEXT -> '},'
  Line 39/48: CONTEXT -> '"devDependencies": {'
  Line 40/49: CONTEXT -> '"@antfu/eslint-config": "catalog:quality",'
  Line 50: ADDED -> '"@clack/prompts": "catalog:util",'
  Line 41/51: CONTEXT -> '"@iconify-json/catppuccin": "catalog:ui",'
  Line 42/52: CONTEXT -> '"@iconify-json/ph": "catalog:ui",'
  Line 43: DELETED -> '"@nuxt/content": "catalog:content",'
  Line 44: DELETED -> '"@nuxt/icon": "catalog:ui",'
  Line 45: DELETED -> '"@nuxt/image": "catalog:ui",'
  Line 46: DELETED -> '"@nuxtjs/color-mode": "catalog:ui",'
  Line 47: DELETED -> '"@nuxtjs/seo": "catalog:content",'
  Line 48: DELETED -> '"@pinia/nuxt": "catalog:util",'
  Line 49: DELETED -> '"@shikijs/colorized-brackets": "catalog:content",'
  Line 50: DELETED -> '"@shikijs/transformers": "catalog:content",'
  Line 51: DELETED -> '"@vueuse/core": "catalog:util",'
  Line 52: DELETED -> '"@vueuse/nuxt": "catalog:util",'
  Line 53: DELETED -> '"@vueuse/router": "catalog:util",'
  Line 54/53: CONTEXT -> '"@zinkawaii/stylelint-config": "catalog:quality",'
  Line 54: ADDED -> '"better-sqlite3": "catalog:content",'
  Line 55/55: CONTEXT -> '"cross-env": "catalog:framework",'
  Line 56/56: CONTEXT -> '"eslint": "catalog:quality",'
  Line 57: DELETED -> '"nuxt": "catalog:framework",'
  Line 57: ADDED -> '"fast-xml-parser": "catalog:util",'
  Line 58: ADDED -> '"nanoid": "catalog:util",'
  Line 59: ADDED -> '"rehype-katex": "catalog:content",'
  Line 60: ADDED -> '"remark-math": "catalog:content",'
  Line 58/61: CONTEXT -> '"remark-reading-time": "catalog:content",'
  Line 59/62: CONTEXT -> '"sass-embedded": "catalog:framework",'
  Line 60: DELETED -> '"shiki": "catalog:content",'
  Line 61/63: CONTEXT -> '"stylelint": "catalog:quality",'
  Line 62/64: CONTEXT -> '"terser": "catalog:util",'
  Line 63/65: CONTEXT -> '"typescript": "catalog:framework",'
  Line 64: DELETED -> '"vue": "catalog:framework",'
  Line 65: DELETED -> '"vue-router": "catalog:framework"'
  Line 66: ADDED -> '"unplugin-yaml": "catalog:framework"'
  Line 66/67: CONTEXT -> '}'
  Line 67/68: CONTEXT -> '}'

================================================================================

File 10/10: scripts/new-blog.ts (Status: modified)
--------------------------------------------------
  This file was modified:
  --- Diff Hunk: @@ -1,71 +1,179 @@ ---
  Line 1: ADDED -> '#!/usr/bin/env node'
  Line 2: ADDED -> ''
  Line 1/3: CONTEXT -> 'import { exec } from 'node:child_process''
  Line 2/4: CONTEXT -> 'import fs from 'node:fs''
  Line 3/5: CONTEXT -> 'import path from 'node:path''
  Line 4/6: CONTEXT -> 'import process from 'node:process''
  Line 7: ADDED -> 'import { intro, log, outro, select, spinner, text } from '@clack/prompts''
  Line 5/8: CONTEXT -> 'import { customAlphabet } from 'nanoid''
  Line 6/9: CONTEXT -> 'import blogConfig from '../blog.config.ts''
  Line 7/10: CONTEXT -> ''
  Line 8: DELETED -> '// 获取当前路径和参数'
  Line 9: DELETED -> 'const args = process.argv.slice(2)'
  Line 10: DELETED -> 'const blogTitle = args[0]'
  Line 11: DELETED -> ''
  Line 12: DELETED -> 'if (!blogTitle) {'
  Line 13: DELETED -> 'console.error('请提供博客标题，如：pnpm new blog-title')'
  Line 14: DELETED -> 'process.exit(1)'
  Line 11: ADDED -> 'function normalize(val: string | symbol | undefined): string | undefined {'
  Line 12: ADDED -> 'return typeof val === 'symbol' ? undefined : val?.trim()'
  Line 15/13: CONTEXT -> '}'
  Line 16/14: CONTEXT -> ''
  Line 17: DELETED -> '// 获取当前年份'
  Line 15: ADDED -> '// 参数'
  Line 16: ADDED -> 'let fileName: string | undefined = process.argv[2]'
  Line 17: ADDED -> 'const usePermalink = blogConfig.article.useRandomPremalink'
  Line 18/18: CONTEXT -> 'const now = new Date()'
  Line 19: DELETED -> 'const year = now.getFullYear()'
  Line 20: DELETED -> 'const directory = path.join(process.cwd(), 'content', 'posts', year.toString())'
  Line 21/19: CONTEXT -> ''
  Line 22: DELETED -> '// 确保目录存在'
  Line 23: DELETED -> 'if (!fs.existsSync(directory)) {'
  Line 24: DELETED -> 'fs.mkdirSync(directory, { recursive: true })'
  Line 25: DELETED -> '}'
  Line 20: ADDED -> 'const dir = path.join('content', 'posts', now.getFullYear().toString())'
  Line 21: ADDED -> ''
  Line 22: ADDED -> 'const absDir = path.join(process.cwd(), dir)'
  Line 23: ADDED -> 'if (!fs.existsSync(absDir))'
  Line 24: ADDED -> 'fs.mkdirSync(absDir, { recursive: true })'
  Line 25: ADDED -> ''
  Line 26: ADDED -> 'intro(usePermalink ? '📝 使用中文名 + 随机 URL 新建文章' : '📝 使用指定文件名 + 年份 URL 新建文章')'
  Line 27: ADDED -> ''
  Line 28: ADDED -> 'if (fileName)'
  Line 29: ADDED -> 'log.info(`文件名: ${path.join(dir, fileName)}.md`)'
  Line 30: ADDED -> ''
  Line 31: ADDED -> 'const permalink = usePermalink'
  Line 32: ADDED -> '? `/posts/${customAlphabet('1234567890abcdef', 7)()}`'
  Line 33: ADDED -> ': undefined'
  Line 34: ADDED -> ''
  Line 35: ADDED -> 'do {'
  Line 36: ADDED -> 'if (fileName || usePermalink)'
  Line 37: ADDED -> 'break'
  Line 38: ADDED -> ''
  Line 39: ADDED -> 'fileName = normalize(await text({'
  Line 40: ADDED -> 'message: `请输入文件名（将创建在 ${dir} 下）`,'
  Line 41: ADDED -> 'placeholder: `monthly-${now.getMonth() + 1}`,'
  Line 42: ADDED -> 'validate: val => val.trim() === '' ? '文件名不能为空' : undefined,'
  Line 43: ADDED -> '}))'
  Line 44: ADDED -> 'if (!fileName)'
  Line 45: ADDED -> 'process.exit(0)'
  Line 46: ADDED -> ''
  Line 47: ADDED -> 'if (fs.existsSync(path.join(absDir, `${fileName}.md`))) {'
  Line 48: ADDED -> 'log.error('❌ 文件已存在')'
  Line 49: ADDED -> 'fileName = undefined'
  Line 50: ADDED -> '}'
  Line 51: ADDED -> '} while (!fileName)'
  Line 52: ADDED -> ''
  Line 53: ADDED -> 'let title = fileName'
  Line 26/54: CONTEXT -> ''
  Line 27: DELETED -> 'const filePath = path.join(directory, `${blogTitle}.md`)'
  Line 55: ADDED -> '// 请求标题'
  Line 56: ADDED -> 'do {'
  Line 57: ADDED -> 'if (title)'
  Line 58: ADDED -> 'break'
  Line 28/59: CONTEXT -> ''
  Line 29: DELETED -> 'if (fs.existsSync(filePath)) {'
  Line 30: DELETED -> 'console.error('文件已存在')'
  Line 60: ADDED -> 'title = normalize(await text({'
  Line 61: ADDED -> 'message: '请输入博客标题','
  Line 62: ADDED -> 'placeholder: `${now.getMonth() + 1}月生活`,'
  Line 63: ADDED -> 'validate: val => val.trim() === '' ? '标题不能为空' : undefined,'
  Line 64: ADDED -> '}))'
  Line 65: ADDED -> 'if (!title)'
  Line 66: ADDED -> 'process.exit(0)'
  Line 67: ADDED -> ''
  Line 68: ADDED -> 'if (usePermalink) {'
  Line 69: ADDED -> 'if (fs.existsSync(path.join(absDir, `${title}.md`))) {'
  Line 70: ADDED -> 'log.error('❌ 文件已存在')'
  Line 71: ADDED -> 'title = undefined'
  Line 72: ADDED -> '}'
  Line 73: ADDED -> '}'
  Line 74: ADDED -> '} while (!title)'
  Line 75: ADDED -> ''
  Line 76: ADDED -> 'const relPath = path.join(dir, `${usePermalink ? title : fileName}.md`)'
  Line 77: ADDED -> 'if (!process.argv[2])'
  Line 78: ADDED -> 'log.info(`文件名: ${relPath}`)'
  Line 79: ADDED -> ''
  Line 80: ADDED -> 'const absPath = path.join(process.cwd(), relPath)'
  Line 81: ADDED -> 'if (fs.existsSync(absPath)) {'
  Line 82: ADDED -> 'log.error('❌ 文件已存在')'
  Line 31/83: CONTEXT -> 'process.exit(1)'
  Line 32/84: CONTEXT -> '}'
  Line 33/85: CONTEXT -> ''
  Line 34: DELETED -> 'let permalink: string | undefined'
  Line 35: DELETED -> 'if (blogConfig.content.randomPathAtNew) {'
  Line 36: DELETED -> 'const hash = customAlphabet('0123456789abcdef', 7)()'
  Line 37: DELETED -> 'permalink = `/posts/${hash}`'
  Line 86: ADDED -> '// 分类'
  Line 87: ADDED -> 'let category = normalize(await select({'
  Line 88: ADDED -> 'message: '请选择分类','
  Line 89: ADDED -> 'options: ['
  Line 90: ADDED -> '...Object.keys(blogConfig.article.categories).map(c => ({ value: c, label: c })),'
  Line 91: ADDED -> '{ value: 'custom', label: '自定义' },'
  Line 92: ADDED -> '],'
  Line 93: ADDED -> '}))'
  Line 94: ADDED -> 'if (!category)'
  Line 95: ADDED -> 'process.exit(0)'
  Line 96: ADDED -> ''
  Line 97: ADDED -> '// 自定义分类'
  Line 98: ADDED -> 'if (category === 'custom') {'
  Line 99: ADDED -> 'const customCategory = normalize(await text({'
  Line 100: ADDED -> 'message: '请输入自定义分类','
  Line 101: ADDED -> 'validate: val => val.trim() === '' ? '分类不能为空' : undefined,'
  Line 102: ADDED -> '}))'
  Line 103: ADDED -> 'if (!customCategory)'
  Line 104: ADDED -> 'process.exit(0)'
  Line 105: ADDED -> 'category = customCategory'
  Line 38/106: CONTEXT -> '}'
  Line 39/107: CONTEXT -> ''
  Line 108: ADDED -> '// 标签'
  Line 109: ADDED -> 'const tagsInput = normalize(await text({'
  Line 110: ADDED -> 'message: '请输入标签（多个用中英文逗号或空格分隔）','
  Line 111: ADDED -> 'placeholder: 'Vue, Vite, TypeScript','
  Line 112: ADDED -> '}))'
  Line 113: ADDED -> 'const tags = tagsInput?.split(/[\s,，]+/).map(t => t.trim()).filter(Boolean)'
  Line 114: ADDED -> ''
  Line 115: ADDED -> '// 样式类型'
  Line 116: ADDED -> 'let type = normalize(await select({'
  Line 117: ADDED -> 'message: '选择文章类型','
  Line 118: ADDED -> 'options: ['
  Line 119: ADDED -> '{ value: 'tech', label: '技术 (tech)' },'
  Line 120: ADDED -> '{ value: 'story', label: '故事 (story)' },'
  Line 121: ADDED -> '{ value: 'custom', label: '自定义' },'
  Line 122: ADDED -> '],'
  Line 123: ADDED -> 'initialValue: 'tech','
  Line 124: ADDED -> '}))'
  Line 125: ADDED -> 'if (!type)'
  Line 126: ADDED -> 'process.exit(0)'
  Line 127: ADDED -> 'if (type === 'custom') {'
  Line 128: ADDED -> 'const customType = normalize(await text({'
  Line 129: ADDED -> 'message: '请输入自定义类型','
  Line 130: ADDED -> 'validate: val => val.trim() === '' ? '类型不能为空' : undefined,'
  Line 131: ADDED -> '}))'
  Line 132: ADDED -> 'if (!customType)'
  Line 133: ADDED -> 'process.exit(0)'
  Line 134: ADDED -> ''
  Line 135: ADDED -> 'log.warn('⚠️ 新建分类后，建议在 blog.config.ts 中添加对应配置')'
  Line 136: ADDED -> 'type = customType'
  Line 137: ADDED -> '}'
  Line 138: ADDED -> ''
  Line 139: ADDED -> '// frontmatter'
  Line 40/140: CONTEXT -> 'const frontmatter = {'
  Line 41: DELETED -> 'title: blogTitle,'
  Line 42: DELETED -> 'description: blogTitle,'
  Line 141: ADDED -> 'title,'
  Line 142: ADDED -> 'description: `讲述关于${title}的故事，并根据${tags?.join('、') ?? ''}给出${category}。`,'
  Line 43/143: CONTEXT -> 'date: `${now.toLocaleDateString('en-CA')} ${now.toLocaleTimeString()}`,'
  Line 44/144: CONTEXT -> 'updated: `${now.toLocaleDateString('en-CA')} ${now.toLocaleTimeString()}`,'
  Line 45/145: CONTEXT -> 'image: '# 图片','
  Line 46/146: CONTEXT -> 'permalink,'
  Line 47: DELETED -> 'type: '# story','
  Line 48: DELETED -> 'categories: '[分类]','
  Line 49: DELETED -> 'tags: '[标签1, 标签2]','
  Line 147: ADDED -> 'type: type === 'tech' ? undefined : type,'
  Line 148: ADDED -> 'categories: category === blogConfig.defaultCategory ? undefined : `[${category}]`,'
  Line 149: ADDED -> 'tags: tags ? `[${tags.join(', ')}]` : undefined,'
  Line 150: ADDED -> '// draft: 'true # 撰写完成后，请删除此行','
  Line 50/151: CONTEXT -> '}'
  Line 51/152: CONTEXT -> ''
  Line 52: DELETED -> '// 创建 Markdown 文件'
  Line 53: DELETED -> 'fs.writeFileSync(filePath, `---\n${Object.entries(frontmatter)'
  Line 153: ADDED -> '// 写文件'
  Line 154: ADDED -> 'fs.writeFileSync(absPath, `---\n${Object.entries(frontmatter)'
  Line 54/155: CONTEXT -> '.filter(([, value]) => value !== undefined)'
  Line 55/156: CONTEXT -> '.map(([key, value]) => `${key}: ${value}`)'
  Line 56/157: CONTEXT -> '.join('\n')}'
  Line 57/158: CONTEXT -> '---'
  Line 58/159: CONTEXT -> ''
  Line 59: DELETED -> '## ${blogTitle}的第一个小标题'
  Line 160: ADDED -> '## 从${title}说起'
  Line 60/161: CONTEXT -> ''
  Line 61/162: CONTEXT -> '`, 'utf8')'
  Line 62/163: CONTEXT -> ''
  Line 63: DELETED -> '// 使用 VS Code 打开文件'
  Line 64: DELETED -> 'exec(`code "${filePath}"`, (error) => {'
  Line 65: DELETED -> 'if (error) {'
  Line 66: DELETED -> 'console.error(`无法打开文件: ${error.message}`)'
  Line 67: DELETED -> '}'
  Line 68: DELETED -> 'else {'
  Line 69: DELETED -> 'console.log(`已创建并打开 ${filePath}`)'
  Line 70: DELETED -> '}'
  Line 164: ADDED -> 'log.info(`✅ 已创建: ${absPath}`)'
  Line 165: ADDED -> 'if (permalink)'
  Line 166: ADDED -> 'log.info(`🔗 文章链接: ${new URL(permalink, blogConfig.url)}`)'
  Line 167: ADDED -> ''
  Line 168: ADDED -> '// 打开 VS Code'
  Line 169: ADDED -> 'const s = spinner()'
  Line 170: ADDED -> 's.start('正在打开 VS Code...')'
  Line 171: ADDED -> 'exec(`code "${absPath}"`, (error) => {'
  Line 172: ADDED -> 'if (!error)'
  Line 173: ADDED -> 'return'
  Line 174: ADDED -> 's.stop('⚠️ 无法打开 VS Code，请确认已通过命令面板注册 code 命令到 PATH')'
  Line 175: ADDED -> 'log.error(error.message)'
  Line 176: ADDED -> 'process.exit(1)'
  Line 71/177: CONTEXT -> '})'
  Line 178: ADDED -> 's.stop('⌨ 已通过 VS Code 打开文件')'
  Line 179: ADDED -> 'outro(`🎉 开始书写吧！`)'

================================================================================

